{% extends 'base.html' %}
{% load static %}

{# Template contributed by Mileiny - ingredient index/browsing functionality #}

{% block head %}
<link rel="stylesheet" href="{% static 'css/form.css' %}" />
{% endblock %}

{% block content %}
<div class="page-header mb-4">
  <h1>Ingredients</h1>
  <img src="{% static 'images/ingredients-icon.svg' %}" alt="Ingredients" />
</div>

<!-- Quick Add Ingredient Form -->
<div class="quick-add mb-4 p-3 border rounded bg-light">
  <h3>Add New Ingredient</h3>
  <form action="{% url 'ingredient_add' %}" method="post" class="d-flex flex-wrap gap-2 align-items-end">
    {% csrf_token %}
    <div class="form-group flex-grow-1">
      {{ form.name.label_tag }}
      {{ form.name }}
      {{ form.name.errors }}
    </div>

    <div class="form-group">
      {{ form.ingredient_type.label_tag }}
      {{ form.ingredient_type }}
      {{ form.ingredient_type.errors }}
    </div>

    <div class="form-group flex-grow-1">
      {{ form.alcohol_content.label_tag }}
      {{ form.alcohol_content }}
      {{ form.alcohol_content.errors }}
    </div>

    <button type="submit" class="btn btn-success">Add Ingredient</button>
  </form>
</div>

<!-- Accordion for Categories -->
<div class="accordion" id="ingredientsAccordion">

  {% for category_key, category_label in categories %}
  <div class="accordion-item">
    <h2 class="accordion-header" id="heading{{ category_key|capfirst }}">
      <button class="accordion-button {% if not forloop.first %}collapsed{% endif %}" type="button"
              data-bs-toggle="collapse" data-bs-target="#collapse{{ category_key|capfirst }}">
        {{ category_label }}
      </button>
    </h2>

    <div id="collapse{{ category_key|capfirst }}" class="accordion-collapse collapse {% if forloop.first %}show{% endif %}" 
         data-bs-parent="#ingredientsAccordion">
      <div class="accordion-body">
        {% if ingredients_by_category[category_key] %}
        <ul class="list-group">
          {% for ingredient in ingredients_by_category[category_key] %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
              {{ ingredient.name }}
              <span class="badge bg-secondary">
                {% if ingredient.is_alcoholic %}Alcoholic{% else %}Non-alcoholic{% endif %}
              </span>
            </li>
          {% endfor %}
        </ul>
        {% else %}
          <p class="text-muted">No ingredients in this category yet.</p>
        {% endif %}
      </div>
    </div>
  </div>
  {% endfor %}

</div>
{% endblock %}
